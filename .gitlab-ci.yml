# Use a Docker image that has C++, CMake, and GTest pre-installed.
# A standard Ubuntu image can be used, but installing tools takes time.
# Using a base image with development tools is often faster.
image: gcc:12

# Define the stages (the different phases of your pipeline)
stages:
  - build_and_test

# Define a job within the build_and_test stage
compile_and_run:
  stage: build_and_test
  script:
    - echo "Preparing build directory..."
    # 1. Create a separate directory for the build output, as recommended by CMake
    - mkdir build
    - cd build
    - echo "Running CMake to configure the project..."
    # 2. Run CMake to generate Makefiles for the project
    - cmake ..
    - echo "Compiling the project..."
    # 3. Run 'make' to compile all targets (main application and tests)
    - make
    - echo "Running all unit tests..."
    # 4. Run the compiled test executable(s)
    # The 'run_tests' target is typically generated by CMake/GTest setup
    - ./test/run_tests
####################################################33


#image: gcc:latest
#
#stages:
#  - build
#  - test
#
## Phase 1: Compile the code
#build:
#  stage: build
#  before_script:
#    - apt-get update && apt-get install -y cmake
#  script:
#    - mkdir build
#    - cd build
#    - cmake ..
#    - make VDSProject_Test
#  artifacts:
#    paths:
#      - build/
#
## Phase 2: Run the Tests
#test:
#  stage: test
#  script:
#    - cd build
#    - ./VDSProject_Test